<ion-modal-view class="popup">
    <i class="fa fa-times close" data-ng-click="hideUserSettings()"></i>
    <ion-content class="color-bg popup-mode" delegate-handle="modalContent" overflow-scroll="true">
        <!-- Product Images -->
        <ion-item class="item-divider title" data-ng-class="{cssArabicRight: $root.arabic_rtl}">
            <span class="divider-padding no-padding-h">{{ translate('USER_SETTINGS') }}</span>
        </ion-item>
        <!-- <ion-item> -->
            <div class="webtabs" data-ng-if="NEW_FEATURES.MULTI_ADDRESS && curUser.id > 0">
                <div class="tab" data-ng-class="{ 'active': tab == 0 }" data-ng-click="changeTab(0)">
                    {{ translate('PROFILE') }}
                </div>
                <div class="tab" data-ng-class="{ 'active': tab == 1 }" data-ng-click="changeTab(1)">
                    {{ translate('ADDRESSES') }}
                </div>
                <div class="tab" data-ng-if="curUser.qualification && ADDONS.user_reviews" data-ng-class="{ 'active': tab == 2 }" data-ng-click="changeTab(2)">
                    {{ translate('QUALIFICATION') }} {{curUser.qualification}} <i class="fa fa-star"></i>
                </div>
                <div class="tab" data-ng-class="{ 'active': tab == 3 }" data-ng-click="changeTab(3)" data-ng-if="ADDONS.business_multi_owners_module && curUser.level == 2" >
                    {{ translate('BUSINESSES') }}
                </div>
            </div>
            <div class="form editable" select-content data-ng-if="tab == 0">
                <div class="photo-profile">
                    <div id="photo_user_settings" class="drag" style="background-image: url({{curUser.image}}),url({{curUser.photo}});">
                        <div class="edit xs">
                            <p>
                                <i class="fa fa-user"></i>
                            </p>
                            <input id="photo_user_settings_file" type="file" style="display: none;" accept="image/png,image/jpeg,image/jpg">
                        </div>
                    </div>
                </div>
                <div class="group">
                    <div class="w50">
                        <label>{{ translate('NAME') }}*</label>
                        <input data-ng-model="curUser.name" class="editable" type="text">
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('MIDDLE_NAME') }}</label>
                        <input data-ng-model="curUser.middle_name" class="editable" type="text">
                    </div>
                    <div class="w50">
                        <label>{{ translate('LASTNAME') }}*</label>
                        <input data-ng-model="curUser.lastname" class="editable" type="text">
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('SECOND_LASTNAME') }}</label>
                        <input data-ng-model="curUser.second_lastname" class="editable" type="text">
                    </div>
                </div>
                <div class="group">
                    <div class="w50">
                        <label>{{ translate('EMAIL') }}*</label>
                        <input data-ng-model="curUser.email" class="editable" type="text">
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('PASSWORD') }}*</label>
                        <input data-ng-model="curUser.password" class="editable" type="password" autocomplete="new-password">
                    </div>
                </div>
                <div class="group" data-ng-if="NEW_FEATURES.MULTI_ADDRESS">
                    <div class="w50">
                        <label>{{ translate('CELLPHONE') }}</label>
                        <input data-ng-model="curUser.cellphone" class="editable" type="text" onkeypress='return ((event.charCode >= 48 && event.charCode <= 57) || event.charCode == 35 || event.charCode == 42 || event.charCode == 43)'>
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('TYPE') }}</label>
                        <div>
                            <select data-ng-model="curUser.level" class="editable" style="width: 100%;" data-ng-disabled="session_user.id == curUser.id">
                                <option value="">{{ translate('SELECT_TYPE') }}</option>
                                <option value="0" data-ng-selected="curUser.level == 0">{{ translate('SUPER_ADMINISTRATOR') }}</option>
                                <option value="1" data-ng-selected="curUser.level == 1">{{ translate('CITY_MANAGER') }}</option>
                                <option value="2" data-ng-selected="curUser.level == 2">{{ translate('BUSINESS_OWNER') }}</option>
                                <option value="3" data-ng-selected="curUser.level == 3">{{ translate('USER') }}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="group" data-ng-if="!NEW_FEATURES.MULTI_ADDRESS">
                    <div class="w50">
                        <label>{{ translate('PHONE') }}</label>
                        <input data-ng-model="curUser.phone" class="editable" type="text" onkeypress='return ((event.charCode >= 48 && event.charCode <= 57) || event.charCode == 35 || event.charCode == 42 || event.charCode == 43)'>
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('CELLPHONE') }}</label>
                        <input data-ng-model="curUser.cellphone" class="editable" type="text" onkeypress='return ((event.charCode >= 48 && event.charCode <= 57) || event.charCode == 35 || event.charCode == 42 || event.charCode == 43)'>
                    </div>
                </div>
                <div class="group" data-ng-if="!NEW_FEATURES.MULTI_ADDRESS">
                    <div class="w50">
                        <label>{{ translate('ZIPCODE') }}</label>
                        <input data-ng-model="curUser.zipcode" class="editable" type="text">
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('TYPE') }}*</label>
                        <div>
                            <select data-ng-model="curUser.level" class="editable" style="width: 100%;" data-ng-disabled="session_user.id == curUser.id">
                                <option value="">{{ translate('SELECT_TYPE') }}</option>
                                <option value="0" data-ng-selected="curUser.level == 0">{{ translate('SUPER_ADMINISTRATOR') }}</option>
                                <option value="1" data-ng-selected="curUser.level == 1">{{ translate('CITY_MANAGER') }}</option>
                                <option value="2" data-ng-selected="curUser.level == 2">{{ translate('BUSINESS_OWNER') }}</option>
                                <option value="3" data-ng-selected="curUser.level == 3">{{ translate('USER') }}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="group" data-ng-if="!NEW_FEATURES.MULTI_ADDRESS">
                    <div class="w50">
                        <label>{{ translate('COUNTRY') }}</label>
                        <div>
                            <select data-ng-model="curUser.country_id" class="editable" style="width: 100%;">
                                <option value="-1">{{ translate('SELECT_COUNTRY') }}</option>
                                <option data-ng-repeat="country in countries" value="{{country.id}}" data-ng-selected="curUser.country_id == country.id">{{country.name}}</option>
                            </select>
                        </div>
                    </div><!--
                    --><div class="w50">
                        <label>{{ translate('CITY') }}</label>
                        <div>
                            <select data-ng-model="curUser.city_id" class="editable" style="width: 100%;">
                                <option value="-1">{{ translate('SELECT_CITY') }}</option>
                                <option data-ng-repeat="city in cities | filter:{country_id:curUser.country_id}" value="{{city.id}}" data-ng-selected="curUser.city_id == city.id">{{city.name}}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!--<div class="group">
                    <div>
                        <label>{{ translate('ZIPCODE') }}</label>
                        <input data-ng-model="curUser.zipcode" class="editable" type="text">
                    </div>
                </div>-->
                <div class="group" data-ng-if="!NEW_FEATURES.MULTI_ADDRESS">
                    <label>{{ translate('ADDRESS') }}</label>
                    <input id="user-map-adress" data-ng-model="curUser.address" class="editable" type="text" data-ng-change="changeAddress()">
                    <div id="user-map-street" style="height: 250px;"></div>
                </div>
                <br>
                <center data-ng-if="curUser.id != -1">
                    <button class="btn btn-primary" data-ng-click="save(curUser)">{{ translate('SAVE').toUpperCase() }}</button>
                </center>
                <center data-ng-if="curUser.id == -1">
                    <button class="btn btn-primary" data-ng-click="save(curUser)">{{ translate('ADD').toUpperCase() }}</button>
                </center>
            </div>
            <div class="form editable" select-content data-ng-if="tab == 1">
                <!-- <div class="loading" data-ng-if="loading">
                    <i class="fa fa-circle-o-notch fa-spin middle"></i> {{ translate('LOADING') }}...
                </div> -->
                <div class="list" data-ng-if="addresses.length > 0">
                    <div data-ng-click="change(address)" data-ng-repeat="address in addresses" class="list-item" data-ng-class="{ 'selected': address.default }">
                        <div class="left">
                            <i data-ng-if="address.default" class="fa fa-check-circle"></i>
                            <i data-ng-if="!address.default" class="fa fa-circle-o"></i>
                        </div>
                        <div class="right">
                            <i data-ng-click="edit(address);$event.stopPropagation();" class="fa fa-pencil-square-o"></i>
                            <i data-ng-if="!address.default" data-ng-click="delete(address);$event.stopPropagation();" class="fa fa-trash-o"></i>
                        </div>
                        <div class="content">
                            <div class="primary">{{ address.address }}</div>
                            <!-- 
                                SHOW ADDRESS TAG UNTIL ADD THE FUNCTIONALITY TO EDIT IT
                                <div class="secondary">{{ translate(address.tag.toUpperCase()) }}<span data-ng-if="address.internal_number"> &dot; {{ address.internal_number }}</span></div> 
                            -->
                            <div class="secondary" data-ng-if="address.internal_number">{{translate('INTERNAL_NUMBER')}}: {{ address.internal_number }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-offset-2 col-sm-8 center">
                    <button class="btn btn-primary btn-block" data-ng-click="add()">{{translate('ADD_NEW_ADDRESS')}}</button>
                </div>
            </div>
            <div class="form editable" select-content data-ng-if="tab == 2">
                <div class="order-reviews" data-ng-repeat="(key, value) in reviews">
                    <table style="width: 100%;">
                        <tr>
                            <th class="col-sm-4 header">
                                {{translate('FRONT_MAIN_EMAIL_ORDER_NO')}} {{key}}
                            </th>
                            <th class="col-sm-2 center-table header">
                                {{averageReview(value)}} <i class="fa fa-star" style="color: orange"></i>
                            </th>
                            <th class="col-sm-6 header">
                                {{translate('COMMENT')}}
                            </th>
                        </tr>
                        <tr data-ng-repeat="review in value">
                            <td class="col-sm-4 review-item">
                                <img data-ng-src="{{ optimizeImage(review.reviewer.photo) }}"> 
                                {{review.reviewer.name}}
                                <i class="fa fa-car user" data-ng-if="review.type == 2"></i>
                                <i class="fa fa-building user" data-ng-if="review.type == 3"></i>
                                <i class="fa fa-user user" data-ng-if="review.type == 4"></i>
                            </td>
                            <td class="col-sm-2 center-table review-item">
                                {{review.qualification}} <i class="fa fa-star" style="color: orange"></i>
                            </td>
                            <td class="col-sm-6 review-item">
                                {{review.comment}}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="form editable" select-content data-ng-if="tab == 3">
                <div class="group">
                    <label>{{ translate('BUSINESS') }}*</label>
                    <ul>
                        <li>
                            <ion-checkbox class="checkbox-item xs" style="border-left: none; border-right: none" data-ng-model="check_business.all" data-ng-change="toggleAllBusiness()">{{ translate('ALL') }}
                            </ion-checkbox>
                        </li>
                        <li data-ng-repeat="cdeal in business | orderBy:'id*1'">
                            <ion-checkbox class="checkbox-item xs" style="border-left: none; border-right: none" data-ng-model="check_business[cdeal.id]" data-ng-change="toggleBusiness(cdeal)">{{cdeal.id}}. {{cdeal.name}}
                            </ion-checkbox>
                        </li>
                    </ul>
                </div>
            </div>
        <!-- </ion-item> -->
    </ion-content>
</ion-modal-view>
